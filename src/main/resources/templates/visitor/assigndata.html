<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<style>
		table {
			font-family: arial, sans-serif;
			border-collapse: collapse;
			width: 100%;
		}

		td,
		th {
			border: 1px solid rgb(0, 0, 0);
			text-align: left;
			padding: 8px;
		}

		tr:nth-child(even) {
			background-color: #dddddd;
		}
	</style>
	<title> VISITOR DETAILS </title>

	<!-- Custom fonts for this template-->
	<div th:replace="admin/common/layout ::links"> </div>

</head>

<body id="page-top" onload="assignedData();show_AssignData();">
	<div class="card shadow sm-4">
		<!-- Page Wrapper -->
		<div id="wrapper">

			<!-- Sidebar -->
			<div th:replace="admin/common/layout ::side-bar"> </div>
			<!-- End of Sidebar -->

			<!-- Content Wrapper -->
			<div id="content-wrapper" class="d-flex flex-column">

				<!-- Main Content -->
				<div id="content">

					<!-- Topbar -->

					<div th:replace="admin/common/layout ::topbar"> </div>
					<!-- End of Topbar -->

					<!-- Begin Page Content -->
					<div class="container-fluid">

						<!--  $$$$$$$   Jquery Table Start   $$$$$$$  -->

						<div class="card shadow mb-2">
							<div class="col-md-12">
								<div class="row">
									<div align="left" class="container my-2 col-6">
										<h1>Assign Data</h1>

									</div>
									<div align="right" class="container my-2 col-6">
										<button type="button" class="btn btn-outline-warning" data-toggle="modal"
											data-target="#asndtModal" onclick="modaldataget();getvstr()">Assign
											Data</button>
									</div>
									<input type="text" name=" " id="assignInput" placeholder="search  names....">
								</div>

							</div>

						</div>



						<table class="table table-bordered dataTable" width="80%" cellspacing="0" role="grid"
							aria-describedby="dataTable_info" style="width: 100%;" id="assignTable">
							<thread>
								<tr>
									<form id='refresh'>


										<!-- <th scope="col">Employee Id</th> -->
										<th scope="col">Employee Name</th>
										<th scope="col">Visitor Reason</th>
										<th scope="col">Visitor Name</th>
										<th scope="col">Employee Reason</th>

										<th scope="col">Time</th>
										<th scope="col">Date</th>
										<th scope="col">Status</th>

										<th scope="col">Action</th>



									</form>
								</tr>
							</thread>
							<tbody id="mytable">

							</tbody>


						</table>
					</div>
				</div>
				<!--  $$$$$$$   Jquery Table End   $$$$$$$  -->


			</div>
			<!-- /.container-fluid -->

		</div>
		<!-- End of Main Content -->



	</div>
	<!-- End of Content Wrapper -->

	</div>
	<!-- add modal start-->


	<!-- Button trigger modal -->

	<!-- Assign Data Modal -->
	<div class="modal fade" id="asndtModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Assign Data</h5>
					<b<button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"><span
							aria-hidden="true">&times;</span></button>
				</div>
				<form id="addassign">

					<div class="modal-body">
						<div class="form-group">
							<label>Employee Name</label>
							<select type="text" class="form-control" id="emplist" name="empid" placeholder="Enter Name">
							</select>
						</div>
						<div class="form-group">
							<label>Visitor Name</label>
							<select type="text" class="form-control" id="vstrlist" name="visname">
							</select>
							<div class="form-group">
								<label>Reason</label>
								<textarea type="text" class="form-control" name="visreason"
									placeholder="Reason"></textarea>
							</div>
							<div class="form-group">
								<label>Time</label>
								<input type="time" class="form-control" id="time" name="time">
								</input>
							</div>
							<div class="form-group">
								<label>Date</label>
								<input type="date" class="form-control" id="date" name="date">
								</input>
							</div>

						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
							<button type="submit" class="btn btn-primary submit`">Send </button>
						</div>
				</form>
			</div>
		</div>
	</div>
	<!-- add modal close -->

	<!--Assign Data Edit Modal Start-->
	<div class="modal fade" id="assigneditModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Edit Assign Data</h5>
					<button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"> </button>
				</div>
				<form method="POST" id="updateasdta">

					<div class="modal-body">
						<div class="form-group">
							<label>Name</label>
							<select type="text" class="form-control" name="empname" id="empname2"
								placeholder="Enter Name"> </select>
							<input type="hidden" class="form-control" name="id" id="ids" placeholder="Enter Name">
						</div>
						<div class="form-group">
							<label>Email</label>
							<input type="text" class="form-control" name="email" id="email1"
								placeholder="Enter Mail Id">
						</div>
						<div class="form-group">
							<label>Mobile</label>
							<input type="text" class="form-control" name="mobile" id="mobile1"
								placeholder="Enter Your Mobile No" onkeypress="return /^[0-9]*$/i.test(event.key)"
								maxlength="10" minlength="10" required>
						</div>
						<div class="form-group">
							<label>Purpose</label>
							<input type="text" class="form-control" name="purpose" id="purpose2"
								placeholder="Meeting Purpose">
						</div>
						<div class="form-group">
							<label>time</label>
							<input type="time" class="form-control" name="checkIn" id="time2" placeholder="time">
						</div>

						<div class="form-group">
							<label>Date</label>
							<input type="date" class="form-control" name="date" id="date2" placeholder="Date">
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-primary " id="update">Update </button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Edit Modal End-->


	<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
		<div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
			<div class="toast-header">
				<img src="..." class="rounded me-2" alt="...">
				<strong class="me-auto">Meeting</strong>
				<small>1 min ago</small>
				<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
			</div>
			<div class="toast-body">
				Meeting Assign Successfull.
			</div>
		</div>
	</div>
	<!-- 9999999999999999999999999999999 send email modal 999999999999999999999999999999999999-->

	<!-- Button trigger modal -->


	<!-- Modal -->
	<div class="modal fade" id="emailmodal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">send mail</h5>
					<button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"> </button>
				</div>
				<div class="modal-body">
					<h3> Send Email Notification </h3>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary">Send</button>
				</div>
			</div>
		</div>
	</div>









	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<script>
		// &&&&&&&&&& tabledatget function start for emp list in assign modal &&&&&&&&& //
		function modaldataget() {
			//	alert('this is table')
			$.ajax({

				type: 'ajax',
				method: 'GET',
				url: "fetch-all-employee-list-in-visitor",
				data: {},
				async: false,
				dataType: 'json',

				success: function (data) {
					var a = "";
					//alert('table')
					for (i = 0; i < data.length; i++) {

						a +=


							'<option value="' + data[i].id + '">' + data[i].name + '</option>'



					}
					$("#emplist").html(a);
				},
				error: function () {

					alert('Data Inserte Failed')

				},
			});

		};

		//   tabledataget function close //
		//==============fetch-all-vistr-list-in-emp=================//
		function getvstr() {
			//	alert('this is table')
			$.ajax({

				type: 'ajax',
				method: 'GET',
				url: "fetch-all-vistr-list-in-emp",
				data: {},
				async: false,
				dataType: 'json',

				success: function (data) {
					var a = "";
					//alert('table')
					for (i = 0; i < data.length; i++) {

						a +=


							'<option value="' + data[i].name + '">' + data[i].name + '</option>'


					}
					$("#vstrlist").html(a);
				},
				error: function () {

					alert('Data Inserte Failed')

				},
			});

		};
		//==================================//
		//  >>>>>>>>>>>  another table function >>>>>>>>>>>>>>//
		function assignedData() {
			//	alert('this is table')
			$.ajax({

				type: 'ajax',
				method: 'GET',
				url: "fetch-assigndata-All-list",
				data: {},
				async: false,
				dataType: 'json',

				success: function (data) {
					var a = "";
					var status = "";
				   // alert('table')
					for (i = 0; i < data.length; i++) {
						if (data[i].status == 'Accept') {
							status = '<td class="lead-tag" style="color:orange;"><b>' + data[i].status + '</b></td>'
						} else if (data[i].status == 'Reject') {
							status = '<td class="lead-tag" style="color:red"><b>' + data[i].status + '</b></td>'
						} else if (data[i].status == 'Pending') {
							status = '<td class="lead-tag" style="color:#ff33cc"><b>' + data[i].status + '</b></td>'
						} else if (data[i].status == 'Complete') {
							status = '<td class="lead-tag" style="color:green"><b>' + data[i].status + '</b></td>'
						}
						else {
							status = '<td>' + ' ' + '</td>'
						}
						a += '<tr>' +




							'<td>' + data[i].empname + ' ' + data[i].empid + '</td>' +
							'<td>' + data[i].visreason + '</td>' +
							'<td>' + data[i].visname + '</td>' +
							'<td>' + data[i].empreason + '</td>' +
							'<td>' + data[i].time + '</td>' +
							'<td>' + data[i].date + '</td>' +
							status +

						//	'<td>' + '<a  id="' + data[i].id + '"  title="Edit" style=color:blue;cursor:pointer;  class=" editasdta fa fa-edit " data-toggle="modal" data-target="#assigneditModal"></a>  <a id="' + data[i].id + '" title="Delete" style=color:red;cursor:pointer; class="deleteasignsdta fa fa-trash" >  </a>' +
							'<td>' + '    <a id="' + data[i].id + '" title="Delete" align="center" style=color:red;cursor:pointer;   class="deleteasignsdta fa fa-trash" >  </a>  <a id="' + data[i].id + '" title="send messege" align="right" style=color:green;cursor:pointer;  class=" fa fa-check-square"" data-toggle="modal" data-target="#" >  </a>' +
							'</tr>';
					}                                                                                                                                                     // <i class="fa fa-check-square-o" aria-hidden="true"> </i>
					$("#mytable").html(a);
				},
				error: function () {

					alert('Data Inserte Failed')

				},
			});

		};

		//  >>>>>>>>>>>............>>>>>>>>>>>>>//

		//  add function start  //

		$(document).on('submit', '#addassign', function (e) {
			alert('assign meeting')

			e.preventDefault();
			var visname = $('#vstrlist').val;
			var visreason = $('#vstrlist').val;
			var date = $('#date').val;
			var time = $('#time').val;
			var email = $('#emplist').val;

			$.ajax({
				url: "/save-data",
				method: 'POST',
				data: new FormData(this),
				contentType: false,
				processData: false,
				cache: false,
				beforeSend: function () {

					$(".submit").prop('disabled', true);
				},

				success: function (data) {
					//	alert("Employee Added");
					assignedData();
					$(".submit").prop('disabled', false);
					$('#addassign')[0].reset();
					$('#asndtModal').modal('hide');


					sendMail(visname, visreason,date,time,email);



				},
				error: function () {
					alert('Email Already Availble');
				},
			});

		});
		// add function close //
		// new function for send mail// start
		function sendMail() {
			alert('sending' + visname + ' ' + visreason)
			$.ajax({

				type: ajax,
				method: "POST",
				url: "/sendEMail",
				data: {visname, visreason, date, time, email},
				datatype: 'json',

				success: function (data) {

				}
			})
		}

		// delete function start//

		$(document).on('click', '.deleteasignsdta', function () {

			var id = this.id;


			alert('Do you want to delete your data??')

			$.ajax({

				type: "GET",
				url: "/deleteasdta",
				data: {id: id},
				success: function (data) {

					assignedData()
				},
			});
		});
		// delete function close//

		// edit function //
		$(document).on('click', '.editasdta', function () {
			//alert('do you want to edit')
			var id = this.id;
			alert(id)

			$.ajax({

				type: 'ajax',
				method: 'GET',
				url: "/editassigndata",
				data: {id: id},
				async: false,
				datatype: 'json',

				success: function (data) {
					alert('editor')

					$("#ids").val(data.id);

					$("#empname2").val(data.empname);
					alert('name')
					$("#email2").val(data.email);
					$("#mobile2").val(data.mobile);
					$("#purpose2").val(data.purpose);
					$("#time2").val(data.time);
					$("#date2").val(data.date);
					alert('ss')
				},


			});
		});

		$("#update").click(function () {

			var form = $("#updateasdta").serialize();
			//	alert(form)
			$.ajax({
				url: "/updateassigndata",
				type: "POST",
				data: form,

				success: function (data) {
					alert('update successfully done')
					assignedData()
				},
			});
		});

		function show_AssignData() {
			//alert('in show employee')
			$.ajax({

				type: "ajax",
				dataType: 'json',
				url: "/fetch-all-assigndata-list",
				method: 'GET',
				async: false,
				dataType: 'json',
				success: function (data) {

					var html = '';

					var i;

					for (i = 0; i < data.length; i++) {

						html += "<option value=" + data[i].id + ">" + data[i].name + "</option>";

					}
					$("#selectid").html(html);
					location.reload
				},
				error: function () {

				},
			});
		};
		//  ((((((((((((((((((((((((((( employee list in visitor )))))))))))))))))))))))))))  //

		/*		function show_employee() {
					//	alert('in show employee')
					$.ajax({
		
						type: "ajax",
						dataType: 'json',
						url: "/fetch-all-employee-list-in-visitor",
						method: 'GET',
						async: false,
						dataType: 'json',
						success: function (data) {
		
							var html = '';
		
							var i;
		
							for (i = 0; i < data.length; i++) {
		
								html += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
		
							}
							$("#selectid").html(html);
							location.reload
						},
						error: function () {
		
						}
					});
				}
		*/
		//  ((((((((((((((((((((((((((( employee list in visitor end )))))))))))))))))))))))))))  //	

		////////  *****  search bar by jquery   *****  ////////

		$(document).ready(function () {
			$("#assignInput").on("keyup", function () {
				var value = $(this).val().toLowerCase();
				$("#assignTable tr").filter(function () {
					$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
				});
			});
		});


	</script>


	<!-- Bootstrap core JavaScript-->
	<div th:replace="admin/common/layout::fotter"> </div>

</body>

</html>